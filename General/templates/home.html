{% extends 'base.html' %}




{% block content %}



<style type="text/css">
.blur{
filter: blur(2px);
transition: all 1s;
}

.noblur{
    transition: all 2s;
}
</style>

<div class="section">
	<div class="container">
		<div class="row">
            <div class="col-md-12">
    	    </div>
    	</div>
    	<div class="row">
{% for profile in profiles %}
    		<div class="col-md-6 col-lg-6 col-xl-4 profile-pad">
    			<div class="card profile-card-2">
    				<div class="card-img-block">
    					<img class="img-fluid b_img_B blur" id="{{ profile.slug }}" width="1200" height="300" src="https://imagesvc.meredithcorp.io/v3/mm/image?url=https%3A%2F%2Fcdn-image.travelandleisure.com%2Fsites%2Fdefault%2Ffiles%2Fstyles%2F1600x1000%2Fpublic%2Fblue0517.jpg%3Fitok%3DV3825voJ&w=400&c=sc&poi=face&q=85" alt="Card image cap" />
                        
    				</div>

                    <script type="text/javascript">
                        var b_img_S{{ profile.slug }} = document.getElementById("{{ profile.slug }}")
                        var b_img_B{{ profile.slug }} = document.createElement('img')
                        b_img_B{{ profile.slug }}.onload = function(){
                            b_img_S{{ profile.slug }}.src = this.src
                            b_img_S{{ profile.slug }}.className = "img-fluid b_img_B noblur";
                        }

                        setTimeout(function(){
                           b_img_B{{ profile.slug }}.src = '{{ profile.background_image.url }}' ;
                           
                       },50)



                      
                    </script>
                        
                    
    				<div class="card-body pt-5">
    					<a href="{{profile.get_absolute_url}}">
    						<img width="75" height="75" src="https://4.bp.blogspot.com/-H232JumEqSc/WFKY-6H-zdI/AAAAAAAAAEw/DcQaHyrxHi863t8YK4UWjYTBZ72lI0cNACLcB/s1600/profile%2Bpicture.png" id="p{{profile.slug}}" alt="profile-image" class="profile"/>
    					</a>
                    <script type="text/javascript">
                        var img_S{{ profile.slug }} = document.getElementById("p{{ profile.slug }}")
                        var img_B{{ profile.slug }} = document.createElement('img')
                        img_B{{ profile.slug }}.onload = function(){
                            img_S{{ profile.slug }}.src = this.src
                        }
                        setTimeout(function(){
                           img_B{{ profile.slug }}.src = '{{ profile.image.url }}' 
                        },50)  

                          
                    </script>
    					<br>
    					<a href="{{profile.get_absolute_url}}" class="userlinkname">

    						<h5 class="card-title">{{profile.user|truncatechars:15}}
    					    	{% if profile.veryfied %}
    								<li class="material-icons trusted ml-1" data-toggle="tooltip" data-placement="top" title="Trusted" style="color:#007bff;">done_all</li>
    								
    							{% endif %}
    						</h5>
    					</a>

    					{% if user.is_authenticated %}
    						{% if profile.user == user %}
    								
    						{% else %}
                                {% if request.user.profile in profile.friends.all %}
                                    <a href="#" class="btn btn-outline-info ConnectBtn mx-1 fa fa-comment" type="button"data-toggle="tooltip" data-placement="top" title="Chat"></a>

                                {% else %}
                                    {% if profile in request.user.profile.from_user.all %}
                                        <a href="{% url 'user-detail' user.profile.slug %}" class="btn btn-outline-primary ConnectBtn fa fa-question" data-toggle="tooltip" data-placement="top" title="A request for you"></a>

                                    {% elif profile in request.user.profile.to_user.all %}
                                        <a data-href='{{profile.api_sent_friend_request_url}}' href="{{profile.sent_friend_request_url}}" class="btn btn-secondary ConnectBtn fa fa-user-times RequestBtn" data-toggle="tooltip" data-placement="top" title="Cancel request"></a>

                                    {% else %}
                                        <a data-href='{{profile.api_sent_friend_request_url}}' href="{{profile.sent_friend_request_url}}" class="btn btn-outline-info ConnectBtn fa fa-user-plus RequestBtn"  data-toggle="tooltip" data-placement="top" title="Add to connection"></a>

                                    {% endif %}
                                {% endif %}
    						{% endif %}
    					{% else %}
    							<a href="{% url 'login' %}" class="btn btn-outline-info ConnectBtn fa fa-user-plus"></a>
    					{% endif %}


    					{% if profile.description == '' %}

    						<p class="card-text">...</p>

    					{% else %}

    						<p class="card-text">{{profile.description|truncatechars:35}}</p>
    					
    					{% endif %}
    					<hr>

    					{% if not profile.facebock and not profile.twitter and not  profile.linkedin and not profile.instagram and not profile.reddit and not profile.snapchat and not profile.youtube and not profile.email %}
    						<p class="space"></p>
    					{% endif %}
    					<div class="icon-block">
    						{% if profile.facebock %}
    							<a href="{{profile.facebock}}" target="_blank">
    								<i class="fa fa-facebook" data-toggle="tooltip" data-placement="top" title="{{profile.facebock|truncatechars:25}}"></i>
    							</a>
    						{% endif %}

    						{% if profile.twitter %}
    							<a href="{{profile.twitter}}" target="_blank">
    								<i class="fa fa-twitter" data-toggle="tooltip" data-placement="top" title="{{profile.twitter|truncatechars:25}}"></i>
    							</a>
    						{% endif %}

    						{% if profile.linkedin %}
    							<a href="{{profile.linkedin}}" target="_blank">
    								<i class="fa fa-linkedin" data-toggle="tooltip" data-placement="top" title="{{profile.linkedin|truncatechars:25}}"></i>
    							</a>
    						{% endif %}

    						{% if profile.instagram %}
    							<a href="{{profile.instagram}}" target="_blank">
    								<i class="fa fa-instagram" data-toggle="tooltip" data-placement="top" title="{{profile.instagram|truncatechars:25}}"></i>
    							</a>
    						{% endif %}

    						{% if profile.reddit %}
    							<a href="{{profile.reddit}}" target="_blank">
    								<i class="fa fa-reddit" data-toggle="tooltip" data-placement="top" title="{{profile.reddit|truncatechars:25}}"></i>
    							</a>
    						{% endif %}

    						{% if profile.snapchat %}
    							<a href="{{profile.snapchat}}" target="_blank">
                               		<i class="fa fa-snapchat" data-toggle="tooltip" data-placement="top" title="{{profile.snapchat|truncatechars:25}}"></i>
                            	</a>
                            {% endif %}

                            {% if profile.youtube %}
    							<a href="{{profile.youtube}}" target="_blank">
                               		<i class="fa fa-youtube-play" data-toggle="tooltip" data-placement="top" title="{{profile.youtube|truncatechars:25}}"></i>
                            	</a>
                            {% endif %}
                            {% if profile.email %}
    							<a href="mailto:{{profile.email}}" data-toggle="tooltip" data-placement="top" title="{{profile.email|truncatechars:15}}">
                               		<i class="fa fa-envelope"></i>
                            	</a>
                            {% endif %}

 						</div>
    				</div>
    			</div>
    		</div>
{% endfor %}
		</div>
	</div>
</div>

{% block cssblock %}


{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'home/style.css' %}">


{% endblock cssblock %}


{% endblock %}


{% block javascript %}

{% if user.is_authenticated %}
<script type="text/javascript">







$('.RequestBtn').click(function(e){
    e.preventDefault()
    var this_ = $(this)
    var btn3 = $('.Fbtn')
    var FriendRequestUrl = this_.attr("data-href")
    $.ajax({
        url: FriendRequestUrl,
        method: 'GET',
        data: {},
        success: function (data) {
            console.log(data)
            if (data.sent){
                updateBtn(this_)
            }
            else if(data.canceled){
                updateBtn2(this_)
            }
            else if(data.rec_request){
                updateBtn3(this_)

            }
            else if(data.friends){
                updateBtn4(this_)
            }
        },
        error: function (error) {
            console.log(error)

        }


    })
});

$('.DFriend').click(function(e){
    e.preventDefault()
    var this_ = $(this)

    var DeleteFriendUrl = this_.attr("data-href")
    $.ajax({
        url: DeleteFriendUrl,
        method: 'GET',
        data: {},
        success: function (data) {
            console.log(data)
            if (data.deleted){
                updateBtn5(this_)
            }

        },
        error: function (error) {
            console.log(error)

        }


    })
});


function updateBtn(btn){
    btn.attr('class','btn btn-secondary ConnectBtn fa fa-user-times RequestBtn')
    btn.attr('data-original-title','Cancel request')
    btn.attr('title','Cancel request')
}
function updateBtn2(btn){
    btn.attr('class','btn btn-outline-info ConnectBtn fa fa-user-plus RequestBtn')
    btn.attr('data-original-title','Add to connection')
    btn.attr('title','Add to connection')
    
}

function updateBtn3(btn){
    btn.after('<a href="{% url 'user-detail' user.profile.slug %}" class="btn btn-outline-primary ConnectBtn fa fa-question" data-toggle="tooltip" data-placement="top" title="A request for you"></a>')
    btn.hide()

    
}


function updateBtn4(btn){
    btn.after('<a href="#" class="btn btn-outline-info ConnectBtn mx-1 fa fa-comment" type="button"data-toggle="tooltip" data-placement="top" title="Chat"></a>')
    btn.hide()


    
}

function updateBtn5(btn){
    btn.after('<a data-href="{{profile.api_sent_friend_request_url}}" href="{{profile.sent_friend_request_url}}" class="btn btn-outline-info ConnectBtn fa fa-user-plus RequestBtn"  data-toggle="tooltip" data-placement="top" title="Add to connection"></a>')
    btn.hide()


    
}




</script>{% endif %}
{% endblock javascript %}